{"version":3,"file":"bundle.js","sources":["/source-files/resource-shadow/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/resource-shadow/src/main.js","/source-files/resource-shadow/package.json","/source-files/resource-shadow/src/resource-shadow.js","/source-files/resource-shadow/node_modules/fiberglass/node_modules/browserify/node_modules/process/browser.js","/source-files/resource-shadow/src/http-handler.js","/source-files/resource-shadow/node_modules/microee/index.js"],"names":["ResourceShadow","options","this","localKey","url","localStorage","httpHandler","defaultHttpHandler","require","load","microee","mixin","create","prototype","apply","changeFn","data","beforeApply","afterApply","getLocalStorageValue","setLocalStorageValue","save","onChange","loading","saving","saveRequested","onSaved","json","getItem","shadow","self","put","httpHeaders","err","serverJson","onSaveError","processJsonFromServer","loadAndRebase","preJson","onLoaded","stringify","get","loadArguments","onLoadError","newJson","saveAgain","threeWayMerge","parse","original","server","local","call","JSON","headers","emit","shouldRetry","retry","status","indexOf","setTimeout","retryDelay","setUrl","removeItem","setItem","module","exports","noop","process","nextTick","canSetImmediate","window","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","source","stopPropagation","length","fn","shift","push","title","browser","env","argv","on","addListener","once","off","removeListener","removeAllListeners","binding","Error","cwd","chdir","HttpHandler","ajax","method","body","callback","request","XMLHttpRequest","open","setRequestHeader","header","complete","onload","responseText","onerror","send","M","_events","cb","e","i","splice","args","Array","slice","arguments","when","c","dest","k","o","hasOwnProperty"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(e){var r=require(\"./resource-shadow\");if(exports.ResourceShadow=r,exports.create=r.create,e.browser)exports.version=\"{{package-version}}\",exports.homepage=\"{{package-homepage}}\";else{var o=require(\"../package.json\");exports.version=o.version,exports.homepage=o.homepage}}).call(this,require(\"_process\"));","module.exports={\n  \"name\": \"resource-shadow\",\n  \"version\": \"0.0.1\",\n  \"description\": \"\",\n  \"main\": \"./src/main\",\n  \"scripts\": {\n    \"test\": \"gulp test && gulp test-browser\",\n    \"bump\": \"gulp bump\",\n    \"cover\": \"istanbul cover --root src gulp test\",\n    \"cover-report\": \"open coverage/lcov-report/index.html\",\n    \"cover-publish\": \"istanbul cover _mocha --report lcovonly && codeclimate < coverage/lcov.info\"\n  },\n  \"author\": \"Benjamin Eidelman <beneidel@gmail.com>\",\n  \"license\": \"MIT\",\n  \"devDependencies\": {\n    \"bulk-require\": \"^0.2.1\",\n    \"codeclimate-test-reporter\": \"0.0.3\",\n    \"expect.js\": \"~0.3.1\",\n    \"fiberglass\": \"~0.0.11\",\n    \"gulp\": \"^3.8.8\",\n    \"istanbul\": \"^0.3.2\"\n  },\n  \"testling\": {\n    \"harness\": \"mocha\",\n    \"files\": \"test/index.js\",\n    \"scripts\": [\n      \"build/resource-shadow.js\"\n    ],\n    \"browsers\": [\n      \"ie/8..latest\",\n      \"chrome/27..latest\",\n      \"firefox/22..latest\",\n      \"safari/5.1..latest\",\n      \"opera/12..latest\",\n      \"iphone/6..latest\",\n      \"ipad/6..latest\",\n      \"android-browser/4.2..latest\"\n    ]\n  },\n  \"dependencies\": {\n    \"microee\": \"0.0.5\"\n  }\n}\n","var microee = require('microee');\nvar defaultHttpHandler;\n\nfunction ResourceShadow(options) {\n  this.localKey = options.localKey;\n  this.url = options.url;\n  this.options = options;\n  this.localStorage = options.localStorage || localStorage;\n  this.httpHandler = options.httpHandler ||\n    (defaultHttpHandler = defaultHttpHandler || require('./http-handler'));\n  this.load();\n}\n\nmicroee.mixin(ResourceShadow);\n\nResourceShadow.create = function resourceCreate(options) {\n  return new ResourceShadow(options);\n};\n\nResourceShadow.prototype.apply = function resourceChangeApply(changeFn) {\n  var data = this.beforeApply();\n  try {\n    data = changeFn(data) || data;\n  } finally {\n    this.afterApply(data);\n    return this;\n  }\n};\n\nResourceShadow.prototype.beforeApply = function() {\n  return this.getLocalStorageValue();\n};\n\nResourceShadow.prototype.afterApply = function(data) {\n  this.setLocalStorageValue(data);\n  this.data = data;\n  this.save();\n  this.onChange();\n};\n\nResourceShadow.prototype.save = function() {\n  if (this.loading || this.saving) {\n    // changes will be detected at the end of current process\n    return;\n  }\n  this.saveRequested = false;\n  if (!this.url) {\n    // no remote url for this resource\n    this.onSaved();\n    return;\n  }\n  var json = this.localStorage.getItem(this.localKey);\n  if (this.shadow !== json) {\n    // we have changes to save\n    this.saving = true;\n    var self = this;\n    this.httpHandler.put(this.url, this.httpHeaders(), json, function(err, serverJson) {\n      self.saving = false;\n      if (err) {\n        self.onSaveError(err);\n        return;\n      }\n      self.onSaved();\n      self.processJsonFromServer(serverJson, json);\n    });\n  } else {\n    this.onSaved();\n  }\n};\n\nResourceShadow.prototype.loadAndRebase = function() {\n  // load from server, and consider all local data as most recent\n  // note: this will cause a 3-way merge\n  return this.load({});\n};\n\nResourceShadow.prototype.load = function(preJson) {\n\n  this.data = this.getLocalStorageValue();\n\n  if (this.loading || this.saving) {\n    // changes will be detected at the end of current process\n    return this;\n  }\n  if (!this.url) {\n    // no remote url for this resource\n    this.onLoaded();\n    return this;\n  }\n\n  var json;\n  if (preJson) {\n    json = preJson;\n    if (typeof json !== 'string') {\n      json = this.stringify(json);\n    }\n  } else {\n    json = this.localStorage.getItem(this.localKey);\n  }\n\n  this.loading = true;\n  var self = this;\n  this.httpHandler.get(this.url, this.httpHeaders(), function(err, serverJson) {\n    self.loading = false;\n    if (err) {\n      err.loadArguments = [preJson];\n      self.onLoadError(err);\n      return;\n    }\n    self.processJsonFromServer(serverJson, json);\n    self.onLoaded();\n  });\n  return this;\n};\n\nResourceShadow.prototype.processJsonFromServer = function(serverJson, preJson) {\n  this.shadow = serverJson;\n  var newJson = this.localStorage.getItem(this.localKey);\n\n  if (serverJson !== preJson) {\n    // server changes\n    var saveAgain = false;\n    if (preJson !== newJson) {\n      // conflict! both server and local changes happened\n      serverJson = this.threeWayMerge(preJson, serverJson, newJson);\n      if (typeof serverJson === 'object') {\n        serverJson = this.stringify(serverJson);\n      }\n      saveAgain = serverJson !== this.shadow;\n    }\n\n    try  {\n      this.data = this.parse(serverJson);\n    } catch (err) {\n      this.data = null;\n    }\n    this.setLocalStorageValue(this.data);\n    this.onChange();\n\n    if (saveAgain) {\n      this.save();\n    }\n  } else if (preJson !== newJson) {\n    // only local changes, start a new save\n    this.save();\n  }\n};\n\nResourceShadow.prototype.threeWayMerge = function(original, server, local) {\n  if (this.options.threeWayMerge) {\n    return this.options.threeWayMerge.call(this, original, server, local);\n  }\n  // by default, local always wins\n  return local;\n};\n\nResourceShadow.prototype.parse = function(json) {\n  return JSON.parse(json);\n};\n\nResourceShadow.prototype.stringify = function(data) {\n  return JSON.stringify(data);\n};\n\nResourceShadow.prototype.httpHeaders = function() {\n  return this.options.headers;\n};\n\nResourceShadow.prototype.onChange = function() {\n  this.emit('change');\n};\n\nResourceShadow.prototype.onSaved = function() {\n  this.emit('saved');\n};\n\nResourceShadow.prototype.onLoaded = function() {\n  this.emit('loaded');\n};\n\nResourceShadow.prototype.shouldRetry = function(err) {\n  if (this.options.retry === false) {\n    return false;\n  }\n  if (err.status &&\n    [\n      // statuses that might represent temporal failures\n      408, 409, 410, 419, 420, 429, 500, 502,\n      503, 504, 509, 521, 522, 524, 598, 599\n      ].indexOf(err.status) < 0) {\n    return false;\n  }\n  return true;\n};\n\nResourceShadow.prototype.onSaveError = function(err) {\n  var self = this;\n  if (this.shouldRetry(err)) {\n    setTimeout(function() {\n      self.save();\n    }, this.options.retryDelay || 5000);\n  }\n  this.emit('saveerror', err);\n};\n\nResourceShadow.prototype.onLoadError = function(err) {\n  var self = this;\n  if (this.shouldRetry(err)) {\n    setTimeout(function() {\n      self.load.apply(self, err.loadArguments);\n    }, this.options.retryDelay || 5000);\n  }\n  this.emit('loaderror', err);\n};\n\nResourceShadow.prototype.setUrl = function(url, headers) {\n  this.url = url;\n  if (headers) {\n    this.options.headers = headers;\n  }\n  return this;\n};\n\nResourceShadow.prototype.getLocalStorageValue = function() {\n  var json = this.localStorage.getItem(this.localKey);\n  if (json === null || typeof json === 'undefined' || json === '') {\n    return null;\n  }\n  try {\n    return this.parse(json);\n  } catch (err) {\n    return null;\n  }\n};\n\nResourceShadow.prototype.setLocalStorageValue = function(data) {\n  var json;\n  if (data === null || typeof data === 'undefined') {\n    json = null;\n  } else {\n    try {\n      json = this.stringify(data);\n    } catch (err) {\n      json = null;\n    }\n  }\n  if (json === null) {\n    this.localStorage.removeItem(this.localKey);\n  } else {\n    this.localStorage.setItem(this.localKey, json);\n  }\n  return json;\n};\n\nmodule.exports = ResourceShadow;\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","\nfunction HttpHandler() {\n}\n\nHttpHandler.prototype.ajax = function(method, url, headers, body, callback) {\n\n  // simple browser implementation\n  var request = new XMLHttpRequest();\n  request.open(method, url, true);\n  if (body) {\n    request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n  }\n  if (headers) {\n    for (var header in headers) {\n      request.setRequestHeader(header, headers[header]);\n    }\n  }\n\n  var data;\n  var complete = false;\n  request.onload = function() {\n    if (complete) {\n      return;\n    }\n    complete = true;\n    if (request.status >= 200 && request.status < 400) {\n      // Success!\n      data = request.responseText;\n      callback(null, data);\n    } else {\n      // We reached our target server, but it returned an error\n      var err = new Error('http error ' + request.status);\n      err.status = request.status;\n      callback(err);\n    }\n  };\n\n  request.onerror = function(err) {\n    // There was a connection error of some sort\n    if (complete) {\n      return;\n    }\n    complete = true;\n    callback(err);\n  };\n\n  if (body) {\n    request.send(body);\n  } else {\n    request.send();\n  }\n};\n\nHttpHandler.prototype.get = function(url, headers, callback) {\n  return this.ajax('GET', url, headers, null, callback);\n};\n\nHttpHandler.prototype.put = function(url, headers, body, callback) {\n  return this.ajax('PUT', url, headers, body, callback);\n};\n\nmodule.exports = new HttpHandler();\n","function M() { this._events = {}; }\nM.prototype = {\n  on: function(ev, cb) {\n    this._events || (this._events = {});\n    var e = this._events;\n    (e[ev] || (e[ev] = [])).push(cb);\n    return this;\n  },\n  removeListener: function(ev, cb) {\n    var e = this._events[ev] || [], i;\n    for(i = e.length-1; i >= 0 && e[i]; i--){\n      if(e[i] === cb || e[i].cb === cb) { e.splice(i, 1); }\n    }\n  },\n  removeAllListeners: function(ev) {\n    if(!ev) { this._events = {}; }\n    else { this._events[ev] && (this._events[ev] = []); }\n  },\n  emit: function(ev) {\n    this._events || (this._events = {});\n    var args = Array.prototype.slice.call(arguments, 1), i, e = this._events[ev] || [];\n    for(i = e.length-1; i >= 0 && e[i]; i--){\n      e[i].apply(this, args);\n    }\n    return this;\n  },\n  when: function(ev, cb) {\n    return this.once(ev, cb, true);\n  },\n  once: function(ev, cb, when) {\n    if(!cb) return this;\n    function c() {\n      if(!when) this.removeListener(ev, c);\n      if(cb.apply(this, arguments) && when) this.removeListener(ev, c);\n    }\n    c.cb = cb;\n    this.on(ev, c);\n    return this;\n  }\n};\nM.mixin = function(dest) {\n  var o = M.prototype, k;\n  for (k in o) {\n    o.hasOwnProperty(k) && (dest.prototype[k] = o[k]);\n  }\n};\nmodule.exports = M;\n"]}