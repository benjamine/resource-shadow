{"version":3,"file":"bundle.js","sources":["/source-files/resource-shadow/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/resource-shadow/src/main.js","/source-files/resource-shadow/package.json","/source-files/resource-shadow/src/resource-shadow.js","/source-files/resource-shadow/node_modules/fiberglass/node_modules/browserify/node_modules/process/browser.js","/source-files/resource-shadow/src/local-storage-observer.js","/source-files/resource-shadow/src/http-handler.js","/source-files/resource-shadow/node_modules/microee/index.js"],"names":["ResourceShadow","options","this","data","localKey","url","online","localStorage","localStorageObserver","defaultLocalStorageObserver","require","httpHandler","defaultHttpHandler","load","listenForStorageEvent","microee","mixin","create","prototype","apply","changeFn","previousJson","beforeApply","mirrorObject","call","afterApply","json","getItem","getLocalStorageValue","setLocalStorageValue","save","onChange","source","loading","saving","onSaved","shadow","self","put","httpHeaders","err","serverJson","discardNextServerResponse","emit","onSaveError","processJsonFromServer","loadAndRebase","loadLocal","changeInfo","currentDataJson","stringify","changed","preJson","onLoaded","get","loadArguments","onLoadError","currentLocalJson","saveAgain","threeWayMerge","serverData","parse","listeningForStorageEvent","onKeyChange","settingLocalStorage","target","copyMember","key","sourceValue","targetValue","Array","sourceLength","length","i","name","original","server","local","JSON","headers","shouldRetry","retry","status","indexOf","setTimeout","retryDelay","goOnline","reset","removeItem","setItem","module","exports","noop","process","nextTick","canSetImmediate","window","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","stopPropagation","fn","shift","push","title","browser","env","argv","on","addListener","once","off","removeListener","removeAllListeners","binding","Error","cwd","chdir","LocalStorageObserver","el","eventName","handler","attachEvent","arguments","e","HttpHandler","ajax","method","body","callback","request","XMLHttpRequest","open","setRequestHeader","header","complete","onload","responseText","onerror","send","M","_events","cb","splice","args","slice","when","c","dest","k","o","hasOwnProperty"],"mappings":"AAAA;ACAA;;AG4CA,QAAS4F,SA1CT,GAAIC,SAAUH,OAAOC,UAErBE,SAAQC,SAAW,WACf,GAAIC,GAAoC,mBAAXC,SAC1BA,OAAOC,aACNC,EAA4B,mBAAXF,SAClBA,OAAOG,aAAeH,OAAOI,gBAGhC,IAAIL,EACA,MAAO,UAAUM,GAAK,MAAOL,QAAOC,aAAaI,GAGrD,IAAIH,EAAS,CACT,GAAII,KAYJ,OAXAN,QAAOI,iBAAiB,UAAW,SAAUG,GACzC,GAAIvE,GAASuE,EAAGvE,MAChB,KAAKA,IAAWgE,QAAqB,OAAXhE,IAAgC,iBAAZuE,EAAGpG,OAC7CoG,EAAGC,kBACCF,EAAM9B,OAAS,GAAG,CAClB,GAAIiC,GAAKH,EAAMI,OACfD,QAGT,GAEI,SAAkBA,GACrBH,EAAMK,KAAKF,GACXT,OAAOG,YAAY,eAAgB,MAI3C,MAAO,UAAkBM,GACrBrB,WAAWqB,EAAI,OAIvBZ,QAAQe,MAAQ,UAChBf,QAAQgB,SAAU,EAClBhB,QAAQiB,OACRjB,QAAQkB,QAIRlB,QAAQmB,GAAKpB,KACbC,QAAQoB,YAAcrB,KACtBC,QAAQqB,KAAOtB,KACfC,QAAQsB,IAAMvB,KACdC,QAAQuB,eAAiBxB,KACzBC,QAAQwB,mBAAqBzB,KAC7BC,QAAQlD,KAAOiD,KAEfC,QAAQyB,QAAU,WACd,KAAM,IAAIC,OAAM,qCAIpB1B,QAAQ2B,IAAM,WAAc,MAAO,KACnC3B,QAAQ4B,MAAQ,WACZ,KAAM,IAAIF,OAAM;;AG7DpB,QAASyB,KAAM9I,KAAK+I,WACpBD,EAAE9H,WACA8F,GAAI,SAAST,EAAI2C,GACfhJ,KAAK+I,UAAY/I,KAAK+I,WACtB,IAAIjB,GAAI9H,KAAK+I,OAEb,QADCjB,EAAEzB,KAAQyB,EAAEzB,QAAWI,KAAKuC,GACtBhJ,MAETkH,eAAgB,SAASb,EAAI2C,GAC3B,GAAgCzE,GAA5BuD,EAAI9H,KAAK+I,QAAQ1C,MACrB,KAAI9B,EAAIuD,EAAExD,OAAO,EAAGC,GAAK,GAAKuD,EAAEvD,GAAIA,KAC/BuD,EAAEvD,KAAOyE,GAAMlB,EAAEvD,GAAGyE,KAAOA,IAAMlB,EAAEmB,OAAO1E,EAAG,IAGpD4C,mBAAoB,SAASd,GACvBA,EACGrG,KAAK+I,QAAQ1C,KAAQrG,KAAK+I,QAAQ1C,OAD/BrG,KAAK+I,YAGjBtG,KAAM,SAAS4D,GACbrG,KAAK+I,UAAY/I,KAAK+I,WACtB,IAAqDxE,GAAjD2E,EAAO9E,MAAMpD,UAAUmI,MAAM7H,KAAKuG,UAAW,GAAOC,EAAI9H,KAAK+I,QAAQ1C,MACzE,KAAI9B,EAAIuD,EAAExD,OAAO,EAAGC,GAAK,GAAKuD,EAAEvD,GAAIA,IAClCuD,EAAEvD,GAAGtD,MAAMjB,KAAMkJ,EAEnB,OAAOlJ,OAEToJ,KAAM,SAAS/C,EAAI2C,GACjB,MAAOhJ,MAAKgH,KAAKX,EAAI2C,GAAI,IAE3BhC,KAAM,SAASX,EAAI2C,EAAII,GAErB,QAASC,KACHD,GAAMpJ,KAAKkH,eAAeb,EAAIgD,GAC/BL,EAAG/H,MAAMjB,KAAM6H,YAAcuB,GAAMpJ,KAAKkH,eAAeb,EAAIgD,GAHhE,MAAIL,IAKJK,EAAEL,GAAKA,EACPhJ,KAAK8G,GAAGT,EAAIgD,GACLrJ,MAPQA,OAUnB8I,EAAEhI,MAAQ,SAASwI,GACjB,GAAqBC,GAAjBC,EAAIV,EAAE9H,SACV,KAAKuI,IAAKC,GACRA,EAAEC,eAAeF,KAAOD,EAAKtI,UAAUuI,GAAKC,EAAED,KAGlD/D,OAAOC,QAAUqD;;AL9CjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AIhDA,QAASf,gBAGTA,YAAY/G,UAAUgH,KAAO,SAASC,EAAQ9H,EAAK0E,EAASqD,EAAMC,GAGhE,GAAIC,GAAU,GAAIC,eAKlB,IAJAD,EAAQE,KAAKL,EAAQ9H,GAAK,GACtB+H,GACFE,EAAQG,iBAAiB,eAAgB,mCAEvC1D,EACF,IAAK,GAAI2D,KAAU3D,GACjBuD,EAAQG,iBAAiBC,EAAQ3D,EAAQ2D,GAI7C,IAAIvI,GACAwI,GAAW,CACfL,GAAQM,OAAS,WACf,IAAID,EAIJ,GADAA,GAAW,EACPL,EAAQpD,QAAU,KAAOoD,EAAQpD,OAAS,IAE5C/E,EAAOmI,EAAQO,aACfR,EAAS,KAAMlI,OACV,CAEL,GAAIqC,GAAM,GAAI+E,OAAM,cAAgBe,EAAQpD,OAC5C1C,GAAI0C,OAASoD,EAAQpD,OACrBmD,EAAS7F,KAIb8F,EAAQQ,QAAU,SAAStG,GAErBmG,IAGJA,GAAW,EACXN,EAAS7F,KAGP4F,EACFE,EAAQS,KAAKX,GAEbE,EAAQS,QAIZd,YAAY/G,UAAUoC,IAAM,SAASjD,EAAK0E,EAASsD,GACjD,MAAOnI,MAAKgI,KAAK,MAAO7H,EAAK0E,EAAS,KAAMsD,IAG9CJ,YAAY/G,UAAUoB,IAAM,SAASjC,EAAK0E,EAASqD,EAAMC,GACvD,MAAOnI,MAAKgI,KAAK,MAAO7H,EAAK0E,EAASqD,EAAMC,IAG9C3C,OAAOC,QAAU,GAAIsC;;CD7DrB,SAAWpC,GAEX,QAAS6B,MAGT,QAAStB,GAAiBuB,EAAIC,EAAWC,GACnCF,EAAGvB,iBACLuB,EAAGvB,iBAAiBwB,EAAWC,GAAS,GAC/BF,EAAGG,aACZH,EAAGG,YAAY,KAAOF,EAAW,WAC/BC,EAAQ1G,MAAMwG,EAAII,aAKxBL,EAAqBxG,UAAU6C,YAAc,SAASI,EAAK0D,GACpDhC,EAAQgB,SAGbT,EAAiBJ,OAAQ,UAAW,SAASgC,GACvCA,EAAE7D,MAAQA,GACZ0D,OAKNnC,OAAOC,QAAU,GAAI+B,KAElBlG,KAAKtB,KAAKQ,QAAQ;;AFxBrB,QAASV,gBAAeC,GACtBC,KAAKC,QACLD,KAAKE,SAAWH,EAAQG,SACxBF,KAAKG,IAAMJ,EAAQI,IACnBH,KAAKD,QAAUA,EACfC,KAAKI,OAASL,EAAQK,UAAW,KAC3BL,EAAQI,KAAQJ,EAAQK,UAAW,EACzCJ,KAAKK,aAAeN,EAAQM,cAAgBA,aAC5CL,KAAKM,qBAAuBP,EAAQO,uBACjCC,4BAA8BA,6BAA+BC,QAAQ,6BACxER,KAAKS,YAAcV,EAAQU,cACxBC,mBAAqBA,oBAAsBF,QAAQ,mBACtDR,KAAKW,OACDX,KAAKM,sBACPN,KAAKY,wBAlBT,GAAIC,SAAUL,QAAQ,WAClBE,mBACAH,2BAoBJM,SAAQC,MAAMhB,gBAEdA,eAAeiB,OAAS,SAAwBhB,GAC9C,MAAO,IAAID,gBAAeC,IAG5BD,eAAekB,UAAUC,MAAQ,SAA6BC,GAC5D,GAAIC,GAAenB,KAAKoB,aACxB,KAC0B,gBAAbF,GACTlB,KAAKqB,aAAaH,EAAUlB,KAAKC,MAEjCiB,EAASI,KAAKtB,KAAMA,KAAKC,MAE3B,QAEA,MADAD,MAAKuB,WAAWJ,GACTnB,OAIXF,eAAekB,UAAUI,YAAc,WACrC,GAAII,GAAOxB,KAAKK,aAAaoB,QAAQzB,KAAKE,SAE1C,OADAF,MAAKqB,aAAarB,KAAK0B,uBAAwB1B,KAAKC,MAC7CuB,GAGT1B,eAAekB,UAAUO,WAAa,SAASJ,GAC7CnB,KAAK2B,qBAAqB3B,KAAKC,MAC/BD,KAAK4B,MAEL,IAAIJ,GAAOxB,KAAKK,aAAaoB,QAAQzB,KAAKE,SACtCsB,KAASL,GACXnB,KAAK6B,UACHC,OAAQ,WAKdhC,eAAekB,UAAUY,KAAO,WAC9B,IAAI5B,KAAK+B,UAAW/B,KAAKgC,OAAzB,CAKA,IAAKhC,KAAKI,SAAWJ,KAAKG,IAExB,WADAH,MAAKiC,SAGP,IAAIT,GAAOxB,KAAKK,aAAaoB,QAAQzB,KAAKE,SAC1C,IAAIF,KAAKkC,SAAWV,EAAM,CAExBxB,KAAKgC,QAAS,CACd,IAAIG,GAAOnC,IACXA,MAAKS,YAAY2B,IAAIpC,KAAKG,IAAKH,KAAKqC,cAAeb,EAAM,SAASc,EAAKC,GAErE,MADAJ,GAAKH,QAAS,EACVG,EAAKK,2BACPL,EAAKK,2BAA4B,MACjCL,GAAKM,KAAK,4BAGRH,MACFH,GAAKO,YAAYJ,IAGnBH,EAAKF,cACLE,GAAKQ,sBAAsBJ,EAAYf,UAGzCxB,MAAKiC,YAITnC,eAAekB,UAAU4B,cAAgB,WAGvC,MAAO5C,MAAKW,UAGdb,eAAekB,UAAU6B,UAAY,SAASC,GAC5C,GAAIC,GAAkB/C,KAAKgD,UAAUhD,KAAKC,KAC1C,IAAID,KAAKK,aAAaoB,QAAQzB,KAAKE,YAAc6C,EAAiB,CAChE,GAAIE,GAAUjD,KAAKqB,aAAarB,KAAK0B,uBAAwB1B,KAAKC,KAC9DgD,KACFH,EAAaA,MACbA,EAAWhB,OAASgB,EAAWhB,QAAU,eACzC9B,KAAK6B,SAASiB,MAKpBhD,eAAekB,UAAUL,KAAO,SAASuC,GAIvC,GAFAlD,KAAK6C,YAED7C,KAAK+B,SAAW/B,KAAKgC,OAEvB,MAAOhC,KAET,KAAKA,KAAKI,SAAWJ,KAAKG,IAGxB,MADAH,MAAKmD,WACEnD,IAGT,IAAIwB,EACA0B,IACF1B,EAAO0B,EACa,gBAAT1B,KACTA,EAAOxB,KAAKgD,UAAUxB,KAGxBA,EAAOxB,KAAKK,aAAaoB,QAAQzB,KAAKE,UAGxCF,KAAK+B,SAAU,CACf,IAAII,GAAOnC,IAgBX,OAfAA,MAAKS,YAAY2C,IAAIpD,KAAKG,IAAKH,KAAKqC,cAAe,SAASC,EAAKC,GAE/D,MADAJ,GAAKJ,SAAU,EACXI,EAAKK,2BACPL,EAAKM,KAAK,gCACVN,EAAKK,2BAA4B,IAG/BF,GACFA,EAAIe,eAAiBH,OACrBf,GAAKmB,YAAYhB,KAGnBH,EAAKQ,sBAAsBJ,EAAYf,OACvCW,GAAKgB,cAEAnD,MAGTF,eAAekB,UAAU2B,sBAAwB,SAASJ,EAAYW,GACpElD,KAAKkC,OAASK,CACd,IAAIgB,GAAmBvD,KAAKK,aAAaoB,QAAQzB,KAAKE,SAEtD,IAAIqC,IAAeW,EAAS,CAE1B,GAAIM,IAAY,CAUhB,IATIN,IAAYK,IAEdhB,EAAavC,KAAKyD,cAAcP,EAASX,EAAYgB,GAC3B,gBAAfhB,KACTA,EAAavC,KAAKgD,UAAUT,IAE9BiB,EAAYjB,IAAevC,KAAKkC,QAG9BK,IAAegB,EAAkB,CACnC,GAAIG,GACAT,GAAU,CACd,KACES,EAAa1D,KAAK2D,MAAMpB,GACxB,MAAOD,GACPoB,EAAa,KAEW,gBAAfA,KACTT,EAAUjD,KAAKqB,aAAaqC,EAAY1D,KAAKC,OAE3CgD,IACFjD,KAAK2B,qBAAqB3B,KAAKC,MAC/BD,KAAK6B,UACHC,OAAQ,YAKV0B,GACFxD,KAAK4B,WAEEsB,KAAYK,GAErBvD,KAAK4B,QAIT9B,eAAekB,UAAUJ,sBAAwB,WAC/C,IAAIZ,KAAK4D,0BAA6B5D,KAAKM,qBAA3C,CAGA,GAAI6B,GAAOnC,IACXA,MAAKM,qBAAqBuD,YAAY7D,KAAKE,SAAU,WAC/CF,KAAK8D,qBAGT3B,EAAKU,WACHf,OAAQ,wBAGZ9B,KAAK4D,0BAA2B,IAGlC9D,eAAekB,UAAUK,aAAe,SAASS,EAAQiC,GAMvD,QAASC,GAAWlC,EAAQiC,EAAQE,GAClC,GAAIC,GAAcpC,EAAOmC,GACrBE,EAAcJ,EAAOE,EACzB,OAAIE,KAAgBD,GACX,EAEkB,mBAAhBC,IACc,gBAAhBD,IACgB,gBAAhBC,IACND,YAAuBE,QAAYD,YAAuBC,OACpDjC,EAAKd,aAAa6C,EAAaC,IAExCJ,EAAOE,GAAOC,GACP,GAlBT,GAAI/B,GAAOnC,IACX,IAAsB,gBAAX8B,IAAyC,gBAAXiC,GACvC,OAAO,CAET,IAAId,IAAU,CAiBd,IAAInB,YAAkBsC,QAASL,YAAkBK,OAAO,CAEtD,IAAK,GADDC,GAAevC,EAAOwC,OACjBC,EAAI,EAAOF,EAAJE,EAAkBA,IAC5BP,EAAWlC,EAAQiC,EAAQQ,KAC7BtB,GAAU,EAOd,OAJIc,GAAOO,SAAWxC,EAAOwC,SAC3BP,EAAOO,OAASxC,EAAOwC,OACvBrB,GAAU,GAELA,EAGT,IAAK,GAAIuB,KAAQ1C,GACXkC,EAAWlC,EAAQiC,EAAQS,KAC7BvB,GAAU,EAGd,KAAKuB,IAAQT,GACiB,mBAAjBjC,GAAO0C,WACTT,GAAOS,GACdvB,GAAU,EAGd,OAAOA,IAGTnD,eAAekB,UAAUyC,cAAgB,SAASgB,EAAUC,EAAQC,GAClE,MAAI3E,MAAKD,QAAQ0D,cACRzD,KAAKD,QAAQ0D,cAAcnC,KAAKtB,KAAMyE,EAAUC,EAAQC,GAG1DA,GAGT7E,eAAekB,UAAU2C,MAAQ,SAASnC,GACxC,MAAOoD,MAAKjB,MAAMnC,IAGpB1B,eAAekB,UAAUgC,UAAY,SAAS/C,GAC5C,MAAO2E,MAAK5B,UAAU/C,IAGxBH,eAAekB,UAAUqB,YAAc,WACrC,MAAOrC,MAAKD,QAAQ8E,SAGtB/E,eAAekB,UAAUa,SAAW,SAASiB,GAC3C9C,KAAKyC,KAAK,SAAUzC,KAAKC,KAAM6C,IAGjChD,eAAekB,UAAUiB,QAAU,WACjCjC,KAAKyC,KAAK,UAGZ3C,eAAekB,UAAUmC,SAAW,WAClCnD,KAAKyC,KAAK,WAGZ3C,eAAekB,UAAU8D,YAAc,SAASxC,GAC9C,MAAItC,MAAKD,QAAQgF,SAAU,GAClB,EAELzC,EAAI0C,SAGJ,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACjCC,QAAQ3C,EAAI0C,QAAU,GACnB,GAEF,GAGTlF,eAAekB,UAAU0B,YAAc,SAASJ,GAC9C,GAAIH,GAAOnC,IACPA,MAAK8E,YAAYxC,IACnB4C,WAAW,WACT/C,EAAKP,QACJ5B,KAAKD,QAAQoF,YAAc,KAEhCnF,KAAKyC,KAAK,YAAaH,IAGzBxC,eAAekB,UAAUsC,YAAc,SAAShB,GAC9C,GAAIH,GAAOnC,IACPA,MAAK8E,YAAYxC,IACnB4C,WAAW,WACT/C,EAAKxB,KAAKM,MAAMkB,EAAMG,EAAIe,gBACzBrD,KAAKD,QAAQoF,YAAc,KAEhCnF,KAAKyC,KAAK,YAAaH,IAGzBxC,eAAekB,UAAUoE,SAAW,SAASjF,EAAK0E,GAQhD,MAPI1E,KACFH,KAAKG,IAAMA,GAET0E,IACF7E,KAAKD,QAAQ8E,QAAUA,GAEzB7E,KAAKI,QAAS,EACPJ,MAGTF,eAAekB,UAAUqE,MAAQ,SAASpF,GAUxC,OATID,KAAK+B,SAAW/B,KAAKgC,UACvBhC,KAAKwC,2BAA4B,GAEnCxC,KAAKI,QAAS,EACdJ,KAAKqB,aAAapB,MAAYD,KAAKC,MACnCD,KAAK2B,qBAAqB3B,KAAKC,MAC/BD,KAAK6B,UACHC,OAAQ,UAEH9B,MAITF,eAAekB,UAAUU,qBAAuB,WAC9C,GAAIF,GAAOxB,KAAKK,aAAaoB,QAAQzB,KAAKE,SAC1C,IAAa,OAATsB,GAAiC,mBAATA,IAAiC,KAATA,EAClD,QAEF,KACE,MAAOxB,MAAK2D,MAAMnC,OAClB,MAAOc,GACP,WAIJxC,eAAekB,UAAUW,qBAAuB,SAAS1B,GACvD,GAAIuB,EACJ,IAAa,OAATvB,GAAiC,mBAATA,GAC1BuB,EAAO,SAEP,KACEA,EAAOxB,KAAKgD,UAAU/C,GACtB,MAAOqC,GACPd,EAAO,KAGX,GAAIL,GAAenB,KAAKK,aAAaoB,QAAQzB,KAAKE,SAClDF,MAAK8D,qBAAsB,CAC3B,KACM3C,IAAiBK,IACN,OAATA,EACFxB,KAAKK,aAAaiF,WAAWtF,KAAKE,UAElCF,KAAKK,aAAakF,QAAQvF,KAAKE,SAAUsB,IAG7C,QACAxB,KAAK8D,qBAAsB,EAG7B,MAAOtC,IAGTgE,OAAOC,QAAU3F","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(e){var r=require(\"./resource-shadow\");if(exports.ResourceShadow=r,exports.create=r.create,e.browser)exports.version=\"{{package-version}}\",exports.homepage=\"{{package-homepage}}\";else{var o=require(\"../package.json\");exports.version=o.version,exports.homepage=o.homepage}}).call(this,require(\"_process\"));","module.exports={\n  \"name\": \"resource-shadow\",\n  \"version\": \"0.0.9\",\n  \"description\": \"\",\n  \"main\": \"./src/main\",\n  \"scripts\": {\n    \"test\": \"gulp test && gulp test-browser\",\n    \"bump\": \"gulp bump\",\n    \"cover\": \"istanbul cover --root src gulp test\",\n    \"cover-report\": \"open coverage/lcov-report/index.html\",\n    \"cover-publish\": \"istanbul cover _mocha --report lcovonly && codeclimate < coverage/lcov.info\"\n  },\n  \"author\": \"Benjamin Eidelman <beneidel@gmail.com>\",\n  \"homepage\": \"https://github.com/benjamine/resource-shadow\",\n  \"license\": \"MIT\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/benjamine/resource-shadow.git\"\n  },\n  \"devDependencies\": {\n    \"bulk-require\": \"^0.2.1\",\n    \"codeclimate-test-reporter\": \"0.0.3\",\n    \"expect.js\": \"~0.3.1\",\n    \"fiberglass\": \"~0.0.11\",\n    \"gulp\": \"^3.8.8\",\n    \"istanbul\": \"^0.3.2\",\n    \"mocha\": \"^2.0.1\"\n  },\n  \"testling\": {\n    \"harness\": \"mocha\",\n    \"files\": \"test/index.js\",\n    \"scripts\": [\n      \"build/resource-shadow.js\"\n    ],\n    \"browsers\": [\n      \"ie/8..latest\",\n      \"chrome/27..latest\",\n      \"firefox/22..latest\",\n      \"safari/5.1..latest\",\n      \"opera/12..latest\",\n      \"iphone/6..latest\",\n      \"ipad/6..latest\",\n      \"android-browser/4.2..latest\"\n    ]\n  },\n  \"dependencies\": {\n    \"microee\": \"0.0.5\"\n  }\n}\n","var microee = require('microee');\nvar defaultHttpHandler;\nvar defaultLocalStorageObserver;\n\nfunction ResourceShadow(options) {\n  this.data = {};\n  this.localKey = options.localKey;\n  this.url = options.url;\n  this.options = options;\n  this.online = options.online === true ||\n    ((!!options.url) && options.online !== false);\n  this.localStorage = options.localStorage || localStorage;\n  this.localStorageObserver = options.localStorageObserver ||\n    (defaultLocalStorageObserver = defaultLocalStorageObserver || require('./local-storage-observer'));\n  this.httpHandler = options.httpHandler ||\n    (defaultHttpHandler = defaultHttpHandler || require('./http-handler'));\n  this.load();\n  if (this.localStorageObserver) {\n    this.listenForStorageEvent();\n  }\n}\n\nmicroee.mixin(ResourceShadow);\n\nResourceShadow.create = function resourceCreate(options) {\n  return new ResourceShadow(options);\n};\n\nResourceShadow.prototype.apply = function resourceChangeApply(changeFn) {\n  var previousJson = this.beforeApply();\n  try {\n    if (typeof changeFn === 'object') {\n      this.mirrorObject(changeFn, this.data);\n    } else {\n      changeFn.call(this, this.data);\n    }\n  } finally {\n    this.afterApply(previousJson);\n    return this;\n  }\n};\n\nResourceShadow.prototype.beforeApply = function() {\n  var json = this.localStorage.getItem(this.localKey);\n  this.mirrorObject(this.getLocalStorageValue(), this.data);\n  return json;\n};\n\nResourceShadow.prototype.afterApply = function(previousJson) {\n  this.setLocalStorageValue(this.data);\n  this.save();\n\n  var json = this.localStorage.getItem(this.localKey);\n  if (json !== previousJson) {\n    this.onChange({\n      source: 'apply'\n    });\n  }\n};\n\nResourceShadow.prototype.save = function() {\n  if (this.loading || this.saving) {\n    // changes will be detected at the end of current process\n    return;\n  }\n\n  if (!this.online || !this.url) {\n    this.onSaved();\n    return;\n  }\n  var json = this.localStorage.getItem(this.localKey);\n  if (this.shadow !== json) {\n    // we have changes to save\n    this.saving = true;\n    var self = this;\n    this.httpHandler.put(this.url, this.httpHeaders(), json, function(err, serverJson) {\n      self.saving = false;\n      if (self.discardNextServerResponse) {\n        self.discardNextServerResponse = false;\n        self.emit('serverresponsediscarded');\n        return;\n      }\n      if (err) {\n        self.onSaveError(err);\n        return;\n      }\n      self.onSaved();\n      self.processJsonFromServer(serverJson, json);\n    });\n  } else {\n    this.onSaved();\n  }\n};\n\nResourceShadow.prototype.loadAndRebase = function() {\n  // load from server, and consider all local data as most recent\n  // note: this will cause a 3-way merge\n  return this.load({});\n};\n\nResourceShadow.prototype.loadLocal = function(changeInfo) {\n  var currentDataJson = this.stringify(this.data);\n  if (this.localStorage.getItem(this.localKey) !== currentDataJson) {\n    var changed = this.mirrorObject(this.getLocalStorageValue(), this.data);\n    if (changed) {\n      changeInfo = changeInfo || {};\n      changeInfo.source = changeInfo.source || 'localStorage';\n      this.onChange(changeInfo);\n    }\n  }\n};\n\nResourceShadow.prototype.load = function(preJson) {\n\n  this.loadLocal();\n\n  if (this.loading || this.saving) {\n    // changes will be detected at the end of current process\n    return this;\n  }\n  if (!this.online || !this.url) {\n    // no remote url for this resource\n    this.onLoaded();\n    return this;\n  }\n\n  var json;\n  if (preJson) {\n    json = preJson;\n    if (typeof json !== 'string') {\n      json = this.stringify(json);\n    }\n  } else {\n    json = this.localStorage.getItem(this.localKey);\n  }\n\n  this.loading = true;\n  var self = this;\n  this.httpHandler.get(this.url, this.httpHeaders(), function(err, serverJson) {\n    self.loading = false;\n    if (self.discardNextServerResponse) {\n      self.emit('serverresponsediscarded');\n      self.discardNextServerResponse = false;\n      return;\n    }\n    if (err) {\n      err.loadArguments = [preJson];\n      self.onLoadError(err);\n      return;\n    }\n    self.processJsonFromServer(serverJson, json);\n    self.onLoaded();\n  });\n  return this;\n};\n\nResourceShadow.prototype.processJsonFromServer = function(serverJson, preJson) {\n  this.shadow = serverJson;\n  var currentLocalJson = this.localStorage.getItem(this.localKey);\n\n  if (serverJson !== preJson) {\n    // server changes\n    var saveAgain = false;\n    if (preJson !== currentLocalJson) {\n      // conflict! both server and local changes happened\n      serverJson = this.threeWayMerge(preJson, serverJson, currentLocalJson);\n      if (typeof serverJson === 'object') {\n        serverJson = this.stringify(serverJson);\n      }\n      saveAgain = serverJson !== this.shadow;\n    }\n\n    if (serverJson !== currentLocalJson) {\n      var serverData;\n      var changed = true;\n      try {\n        serverData = this.parse(serverJson);\n      } catch (err) {\n        serverData = null;\n      }\n      if (typeof serverData === 'object') {\n        changed = this.mirrorObject(serverData, this.data);\n      }\n      if (changed) {\n        this.setLocalStorageValue(this.data);\n        this.onChange({\n          source: 'server'\n        });\n      }\n    }\n\n    if (saveAgain) {\n      this.save();\n    }\n  } else if (preJson !== currentLocalJson) {\n    // only local changes, start a new save\n    this.save();\n  }\n};\n\nResourceShadow.prototype.listenForStorageEvent = function() {\n  if (this.listeningForStorageEvent || !this.localStorageObserver) {\n    return;\n  }\n  var self = this;\n  this.localStorageObserver.onKeyChange(this.localKey, function(){\n    if (this.settingLocalStorage) {\n      return;\n    }\n    self.loadLocal({\n      source: 'localStorageEvent'\n    });\n  });\n  this.listeningForStorageEvent = true;\n};\n\nResourceShadow.prototype.mirrorObject = function(source, target) {\n  var self = this;\n  if (typeof source !== 'object' || typeof target !== 'object') {\n    return false;\n  }\n  var changed = false;\n  function copyMember(source, target, key) {\n    var sourceValue = source[key];\n    var targetValue = target[key];\n    if (targetValue === sourceValue) {\n      return false;\n    }\n    if (typeof targetValue !== 'undefined' &&\n      typeof sourceValue === 'object' &&\n      typeof targetValue === 'object' &&\n      (sourceValue instanceof Array) === (targetValue instanceof Array)) {\n      return self.mirrorObject(sourceValue, targetValue);\n    }\n    target[key] = sourceValue;\n    return true;\n  }\n\n  if (source instanceof Array && target instanceof Array) {\n    var sourceLength = source.length;\n    for (var i = 0; i < sourceLength; i++) {\n      if (copyMember(source, target, i)) {\n        changed = true;\n      }\n    }\n    if (target.length !== source.length) {\n      target.length = source.length;\n      changed = true;\n    }\n    return changed;\n  }\n\n  for (var name in source) {\n    if (copyMember(source, target, name)) {\n      changed = true;\n    }\n  }\n  for (name in target) {\n    if (typeof source[name] === 'undefined') {\n      delete target[name];\n      changed = true;\n    }\n  }\n  return changed;\n};\n\nResourceShadow.prototype.threeWayMerge = function(original, server, local) {\n  if (this.options.threeWayMerge) {\n    return this.options.threeWayMerge.call(this, original, server, local);\n  }\n  // by default, local always wins\n  return local;\n};\n\nResourceShadow.prototype.parse = function(json) {\n  return JSON.parse(json);\n};\n\nResourceShadow.prototype.stringify = function(data) {\n  return JSON.stringify(data);\n};\n\nResourceShadow.prototype.httpHeaders = function() {\n  return this.options.headers;\n};\n\nResourceShadow.prototype.onChange = function(changeInfo) {\n  this.emit('change', this.data, changeInfo);\n};\n\nResourceShadow.prototype.onSaved = function() {\n  this.emit('saved');\n};\n\nResourceShadow.prototype.onLoaded = function() {\n  this.emit('loaded');\n};\n\nResourceShadow.prototype.shouldRetry = function(err) {\n  if (this.options.retry === false) {\n    return false;\n  }\n  if (err.status &&\n    [\n      // statuses that might represent temporal failures\n      408, 409, 410, 419, 420, 429, 500, 502,\n      503, 504, 509, 521, 522, 524, 598, 599\n      ].indexOf(err.status) < 0) {\n    return false;\n  }\n  return true;\n};\n\nResourceShadow.prototype.onSaveError = function(err) {\n  var self = this;\n  if (this.shouldRetry(err)) {\n    setTimeout(function() {\n      self.save();\n    }, this.options.retryDelay || 5000);\n  }\n  this.emit('saveerror', err);\n};\n\nResourceShadow.prototype.onLoadError = function(err) {\n  var self = this;\n  if (this.shouldRetry(err)) {\n    setTimeout(function() {\n      self.load.apply(self, err.loadArguments);\n    }, this.options.retryDelay || 5000);\n  }\n  this.emit('loaderror', err);\n};\n\nResourceShadow.prototype.goOnline = function(url, headers) {\n  if (url) {\n    this.url = url;\n  }\n  if (headers) {\n    this.options.headers = headers;\n  }\n  this.online = true;\n  return this;\n};\n\nResourceShadow.prototype.reset = function(data) {\n  if (this.loading || this.saving) {\n    this.discardNextServerResponse = true;\n  }\n  this.online = false;\n  this.mirrorObject(data || {}, this.data);\n  this.setLocalStorageValue(this.data);\n  this.onChange({\n    source: 'reset'\n  });\n  return this;\n};\n\n\nResourceShadow.prototype.getLocalStorageValue = function() {\n  var json = this.localStorage.getItem(this.localKey);\n  if (json === null || typeof json === 'undefined' || json === '') {\n    return {};\n  }\n  try {\n    return this.parse(json) || {};\n  } catch (err) {\n    return {};\n  }\n};\n\nResourceShadow.prototype.setLocalStorageValue = function(data) {\n  var json;\n  if (data === null || typeof data === 'undefined') {\n    json = null;\n  } else {\n    try {\n      json = this.stringify(data);\n    } catch (err) {\n      json = null;\n    }\n  }\n  var previousJson = this.localStorage.getItem(this.localKey);\n  this.settingLocalStorage = true;\n  try {\n    if (previousJson !== json) {\n      if (json === null) {\n        this.localStorage.removeItem(this.localKey);\n      } else {\n        this.localStorage.setItem(this.localKey, json);\n      }\n    }\n  } finally {\n    this.settingLocalStorage = false;\n  }\n\n  return json;\n};\n\nmodule.exports = ResourceShadow;\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","(function (process){\n\nfunction LocalStorageObserver() {\n}\n\nfunction addEventListener(el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent('on' + eventName, function() {\n      handler.apply(el, arguments);\n    });\n  }\n}\n\nLocalStorageObserver.prototype.onKeyChange = function(key, handler) {\n  if (!process.browser) {\n    return;\n  }\n  addEventListener(window, 'storage', function(e) {\n    if (e.key === key) {\n      handler();\n    }\n  });\n};\n\nmodule.exports = new LocalStorageObserver();\n\n}).call(this,require('_process'))","\nfunction HttpHandler() {\n}\n\nHttpHandler.prototype.ajax = function(method, url, headers, body, callback) {\n\n  // simple browser implementation\n  var request = new XMLHttpRequest();\n  request.open(method, url, true);\n  if (body) {\n    request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n  }\n  if (headers) {\n    for (var header in headers) {\n      request.setRequestHeader(header, headers[header]);\n    }\n  }\n\n  var data;\n  var complete = false;\n  request.onload = function() {\n    if (complete) {\n      return;\n    }\n    complete = true;\n    if (request.status >= 200 && request.status < 400) {\n      // Success!\n      data = request.responseText;\n      callback(null, data);\n    } else {\n      // We reached our target server, but it returned an error\n      var err = new Error('http error ' + request.status);\n      err.status = request.status;\n      callback(err);\n    }\n  };\n\n  request.onerror = function(err) {\n    // There was a connection error of some sort\n    if (complete) {\n      return;\n    }\n    complete = true;\n    callback(err);\n  };\n\n  if (body) {\n    request.send(body);\n  } else {\n    request.send();\n  }\n};\n\nHttpHandler.prototype.get = function(url, headers, callback) {\n  return this.ajax('GET', url, headers, null, callback);\n};\n\nHttpHandler.prototype.put = function(url, headers, body, callback) {\n  return this.ajax('PUT', url, headers, body, callback);\n};\n\nmodule.exports = new HttpHandler();\n","function M() { this._events = {}; }\nM.prototype = {\n  on: function(ev, cb) {\n    this._events || (this._events = {});\n    var e = this._events;\n    (e[ev] || (e[ev] = [])).push(cb);\n    return this;\n  },\n  removeListener: function(ev, cb) {\n    var e = this._events[ev] || [], i;\n    for(i = e.length-1; i >= 0 && e[i]; i--){\n      if(e[i] === cb || e[i].cb === cb) { e.splice(i, 1); }\n    }\n  },\n  removeAllListeners: function(ev) {\n    if(!ev) { this._events = {}; }\n    else { this._events[ev] && (this._events[ev] = []); }\n  },\n  emit: function(ev) {\n    this._events || (this._events = {});\n    var args = Array.prototype.slice.call(arguments, 1), i, e = this._events[ev] || [];\n    for(i = e.length-1; i >= 0 && e[i]; i--){\n      e[i].apply(this, args);\n    }\n    return this;\n  },\n  when: function(ev, cb) {\n    return this.once(ev, cb, true);\n  },\n  once: function(ev, cb, when) {\n    if(!cb) return this;\n    function c() {\n      if(!when) this.removeListener(ev, c);\n      if(cb.apply(this, arguments) && when) this.removeListener(ev, c);\n    }\n    c.cb = cb;\n    this.on(ev, c);\n    return this;\n  }\n};\nM.mixin = function(dest) {\n  var o = M.prototype, k;\n  for (k in o) {\n    o.hasOwnProperty(k) && (dest.prototype[k] = o[k]);\n  }\n};\nmodule.exports = M;\n"]}